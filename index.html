<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Españord Redirect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 60px;
    }
  </style>

  <script>
    // --- OFFICIAL PINTEREST BASE CODE (REINSTATED) ---
    // This defines the pintrk function and handles its internal beacon logic
    !function(e){if(!window.pintrk){window.pintrk=function(){window.pintrk.queue.push(Array.prototype.slice.call(arguments))};var n=window.pintrk;n.queue=[],n.version="3.0";var t=document.createElement("script");t.async=!0,t.src=e;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}}("https://s.pinimg.com/ct/core.js");
  </script>
</head>
<body>
  <h1>Loading...</h1>
  <p>Your Spanish learning adventure is about to begin!</p>

  <script>
    // --- Configuration ---
    const MAIN_DOMAIN = 'españord.com';
    const CANVA_DESTINATION_URL = 'https://españord.com';
    const AD_ID_PARAM = 'epik';
    const COOKIE_NAME = 'campaign_ad_id';
    const PINTEREST_TID = '2612894781060'; 
    const REDIRECT_DELAY_MS = 1000; // 1 full second delay

    // Get adId immediately
    function getAdId() {
      return new URLSearchParams(window.location.search).get(AD_ID_PARAM);
    }

    // --- Main Logic ---

    // Get the Ad ID
    const adId = getAdId();

    // 1. Load Pinterest Tag
    pintrk('load', PINTEREST_TID);

    // 2. Fire PageVisit Event
    // When adId is present, we pass it as 'click_id' in custom_data
    const eventData = adId ? { click_id: adId } : {};
    pintrk('track', 'PageVisit', eventData); 

    console.log(`[Bridge]: Fired Pinterest PageVisit. Click ID: ${adId || 'none'}`);

    // 3. Set cookie (if Ad ID exists)
    if (adId) {
      document.cookie = `${COOKIE_NAME}=${adId}; domain=.${MAIN_DOMAIN}; path=/; max-age=604800; secure; samesite=Lax`;
    }

    // 4. Redirect URL construction
    const redirectUrl = adId
      ? `${CANVA_DESTINATION_URL}?epik=${encodeURIComponent(adId)}`
      : CANVA_DESTINATION_URL;

    // 5. Redirect after the maximum safe delay
    setTimeout(() => {
      console.log("[Bridge]: Redirecting now after max delay.");
      window.location.replace(redirectUrl);
    }, REDIRECT_DELAY_MS);
  </script>
</body>
</html>
